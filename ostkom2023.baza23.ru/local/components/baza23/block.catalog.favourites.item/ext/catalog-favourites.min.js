!function(t){"use strict";t.jsc_CatalogFavouritesItem||(t.jsc_CatalogFavouritesItem=function(t){this.ajax={URL:"/local/components/baza23/block.catalog.favourites.item/ext/ajax.php",MODULE:"module=favourites",ACTION_VARIABLE:"action",ID_VARIABLE:"id",OUTPUT:"console"},this.cssClass="product-item-favourites",this.visual={ID:""},this.obProduct=null,this.errorCode=0,"object"==typeof t&&(t.URL&&(this.ajax.URL=t.URL),this.visual.ID=t.CSS_ID,""===this.visual.ID&&(this.errorCode=-2)),0===this.errorCode?BX.ready(BX.delegate(this.init,this)):console.log("jsc_CatalogFavouritesItem errorCode =",this.errorCode)},t.jsc_CatalogFavouritesItem.prototype={init:function(){if(this.obProduct=$("#"+this.visual.ID),!this.obProduct.length)return this.errorCode=-4,console.log("jsc_CatalogFavouritesItem errorCode =",this.errorCode,"(#"+this.visual.ID+")"),this.errorCode;let s=this,t="."+this.cssClass+' input[type="checkbox"]';this.obProduct.on("change",t,function(){var t=$(this).data("productId");return t&&($(this).is(":checked")?s.jsf_addProductId(t)||$(this).removeAttr("checked"):s.jsf_removeProductId(t)),!1})},jsf_getProductIds:function(){let e=this,a=this.ajax.MODULE+"&SITE_ID="+jso_local.SITE_ID+"&"+this.ajax.ACTION_VARIABLE+"=GET_FAVOURITE_LIST",s=[];return $.ajax({url:this.ajax.URL,type:"GET",data:a,dataType:"json",async:!1,error:function(t,s,o){"console"==e.ajax.OUTPUT?console.log("jsc_CatalogFavouritesItem.jsf_getProductIds",a,s,o):jso_utilities.jsf_ajaxError(t,s,o)},success:function(t){t.success?null!=t.productIds&&null!=t.productIds&&(s=t.productIds):"console"==e.ajax.OUTPUT?console.log("jsc_CatalogFavouritesItem.jsf_getProductIds",t):alert(t.text)}}),s},jsf_addProductId:function(s){let e=this,a=this.ajax.MODULE+"&SITE_ID="+jso_local.SITE_ID+"&"+this.ajax.ID_VARIABLE+"="+s+"&"+this.ajax.ACTION_VARIABLE+"=ADD_TO_FAVOURITE_LIST",o=!1;return $.ajax({url:this.ajax.URL,type:"GET",data:a,dataType:"json",async:!1,error:function(t,s,o){"console"==e.ajax.OUTPUT?console.log("jsc_CatalogFavouritesItem.jsf_addProductId",a,s,o):jso_utilities.jsf_ajaxError(t,s,o)},success:function(t){t.success?(o=!0,$("."+e.cssClass+' input[data-product-id="'+s+'"]').attr("checked","checked"),e.jsf_changeFavouriteCount()):"console"==e.ajax.OUTPUT?console.log("jsc_CatalogFavouritesItem.jsf_addProductId",a,t):alert(t.text)}}),o},jsf_removeProductId:function(s){let e=this,a=this.ajax.MODULE+"&SITE_ID="+jso_local.SITE_ID+"&"+this.ajax.ID_VARIABLE+"="+s+"&"+this.ajax.ACTION_VARIABLE+"=DELETE_FROM_FAVOURITE_LIST",o=!1;return $.ajax({url:this.ajax.URL,type:"GET",data:a,dataType:"json",async:!1,error:function(t,s,o){"console"==e.ajax.OUTPUT?console.log("jsc_CatalogFavouritesItem.jsf_removeProductId",a,s,o):jso_utilities.jsf_ajaxError(t,s,o)},success:function(t){t.success?(o=!0,$("."+e.cssClass+' input[data-product-id="'+s+'"]').removeAttr("checked"),e.jsf_changeFavouriteCount()):"console"==e.ajax.OUTPUT?console.log("jsc_CatalogFavouritesItem.jsf_removeProductId",a,t):alert(t.text)}}),o},jsf_changeFavouriteCount:function(){let t=this.jsf_getProductIds(),s=0,o=$(".catalog-favourites-link");"object"==typeof t?s=Object.keys(t).length:"array"==typeof t&&(s=t.length),o.find(".item-count").html(s),t.length<=0?o.addClass("empty-list"):o.removeClass("empty-list")},jsf_checkFavourites:function(t){let e=this.jsf_getProductIds(),s="."+this.cssClass+' input[type="checkbox"]';$(t).hasClass(this.cssClass)&&(s='input[type="checkbox"]'),e&&$(t).find(s).each(function(t,s){var o=$(this).data("productId");0<=$.inArray(o,e)?$(this).attr("checked","checked"):$(this).removeAttr("checked")})}})}(window);